---
description: >-
  This page provides information on setting up and running NexusForever through
  .NET Aspire.
---

# .NET Aspire

## Prerequisites

* [Docker Desktop](https://www.docker.com/products/docker-desktop/).
* [Visual Studio 2022](https://visualstudio.microsoft.com/downloads/).

See [https://learn.microsoft.com/en-us/dotnet/aspire/fundamentals/setup-tooling](https://learn.microsoft.com/en-us/dotnet/aspire/fundamentals/setup-tooling) for more information on prerequisites.

## Database Server

{% hint style="success" %}
No action required.
{% endhint %}

NexusForever requires a database server and uses Entity Framework which is compatible with various databases, however official support is limited to MySQL and MariaDB.

.NET Aspire will automatically create a MariaDB server and database user automatically via a Docker image.

## Message Broker

{% hint style="success" %}
No action required!
{% endhint %}

NexusForever requires a message broker and uses [Rebus](https://github.com/rebus-org/Rebus) which supports multiple message brokers, however offical support is limited to RabbitMQ and Azure Service Bus.

.NET Aspire will automatically create a RabbitMQ server and user via a Docker image.

## Trust Local HTTPS Certificates

Run the following command in the Command Prompt.

{% code overflow="wrap" lineNumbers="true" %}
```
dotnet dev-certs https --trust
```
{% endcode %}

If you get a security warning you can safely click "Yes".

<figure><img src="../../../.gitbook/assets/image (38).png" alt="" width="458"><figcaption></figcaption></figure>

If successful you should see the following output in the Command Prompt.

<figure><img src="../../../.gitbook/assets/image (39).png" alt="" width="563"><figcaption></figcaption></figure>

## Copy Configuration Files

NexusForever provides default configuration files for servers and .NET Aspire.\
Before starting NexusForever these configuration files need to be copied or renamed.

### Server Configuraiton

Run the following commands in the Command Prompt.

{% hint style="warning" %}
Substitute the `Debug` folder in the path with `Release` if you built NexusForever in release mode.
{% endhint %}

{% code overflow="wrap" lineNumbers="true" %}
```
cd C:\nexusforever\Source\NexusForever.AuthServer\bin\Debug\net9.0\
copy AuthServer.example.json AuthServer.json
cd C:\nexusforever\Source\NexusForever.StsServer\bin\Debug\net9.0\
copy StsServer.example.json StsServer.json
cd C:\nexusforever\Source\NexusForever.WorldServer\bin\Debug\net9.0\
copy WorldServer.example.json WorldServer.json
cd C:\nexusforever\Source\NexusForever.Server.ChatServer\bin\Debug\net9.0\
copy ChatServer.example.json ChatServer.json
cd C:\nexusforever\Source\NexusForever.Server.GroupServer\bin\Debug\net9.0\
copy GroupServer.example.json GroupServer.json
cd C:\nexusforever\Source\NexusForever.API.Character\bin\Debug\net9.0\
copy CharacterAPI.example.json CharacterAPI.json
```
{% endcode %}

### .NET Aspire Configuration

Run the following commands in the Command Prompt.

{% hint style="warning" %}
Substitute the `Debug` folder in the path with `Release` if you built NexusForever in release mode.
{% endhint %}

{% code overflow="wrap" lineNumbers="true" %}
```
cd C:\nexusforever\Source\NexusForever.Aspire.Database.Migrations\bin\Debug\net9.0\
copy AspireMigrations.example.json AspireMigrations.json
```
{% endcode %}

## Starting Server

Start Docker Desktop.

<figure><img src="../../../.gitbook/assets/image (36).png" alt="" width="563"><figcaption></figcaption></figure>

Open `C:\nexusforever\Source\NexusForever.sln` in Visual Studio.

<figure><img src="../../../.gitbook/assets/image (45).png" alt="" width="563"><figcaption></figcaption></figure>

Start NexusForever.Aspire.AppHost by clicking the NexusForever.Aspire.AppHost "Start Debugging" button or using the F5 hotkey.

This will open the NexusForever.Aspire dashboard in your default web browser.

<figure><img src="../../../.gitbook/assets/image (47).png" alt="" width="563"><figcaption></figcaption></figure>

### First Time Startup

The .NET Aspire host may take extra time to start initially as it configures the database and message broker.

.NET Aspire will first download and start Docker images for MySQL and RabbitMQ.

<figure><img src="../../../.gitbook/assets/image (44).png" alt="" width="563"><figcaption></figcaption></figure>

Once MySQL and RabbitMQ have sueccessfully started, .NET Aspire will start the database-migrations helper to setup and configure the databases.

This can be a long running process, you can check the status by clicking on the "Console Logs" button.

<figure><img src="../../../.gitbook/assets/image (40).png" alt="" width="563"><figcaption></figcaption></figure>

The database-migration helper will first apply the Entity Framework migrations for all databases.

<figure><img src="../../../.gitbook/assets/image (42).png" alt="" width="563"><figcaption></figcaption></figure>

Once the Entity Framework migrations have successfully been applied the database-migration helper will create a new NexusForever account with the username and password of `nexusforever`.

{% hint style="info" %}
The username and password for the default NexusForever account can be changed in the `AspireMigrations.json` configuration file.
{% endhint %}

Once the NexusForever account has been sucessfully created the database-migration helper will apply the NexusForever database dumps.

{% hint style="warning" %}
The database migration helper expects the NexusForever database to exist at `C:\nexusforever-database`.\
If you cloned the database to a different directory you will need to update the path in the `AspireMigrations.json` configuration file.
{% endhint %}

<figure><img src="../../../.gitbook/assets/image (41).png" alt="" width="563"><figcaption></figcaption></figure>

Once the NexusForever database dumps have been successfully applied the the database-migration helper will finish.

The NexusForever servers will now begin to start, a successful start shows all resources in a "Running" state except "database-migrations which will display a "Finished" state.

<figure><img src="../../../.gitbook/assets/image (43).png" alt="" width="563"><figcaption></figcaption></figure>
